<!DOCTYPE html>
<html lang="bn">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Student Portal | RASEL'S ICT ACADEMY</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
      <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
      <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

      <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
            import { getFirestore, collection, addDoc, query, where, getDocs, onSnapshot, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

            const firebaseConfig = {
                  apiKey: "AIzaSyBKFKKfNmmf9lvLdARZzL4WfSqqYeyN5P0",
                  authDomain: "rasel-ict-hub-61ce0.firebaseapp.com",
                  projectId: "rasel-ict-hub-61ce0",
                  storageBucket: "rasel-ict-hub-61ce0.firebasestorage.app",
                  messagingSenderId: "914822238317",
                  appId: "1:914822238317:web:f4fc09d89ca8bfd932af64",
                  measurementId: "G-H50N54TXN8"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth();
            const db = getFirestore(app);

            // --- Sidebar Toggle Logic ---
            window.toggleSidebar = () => {
                  const sidebar = document.getElementById('sidebar-aside');
                  const toggleBtn = document.getElementById('floating-toggle-btn');

                  if (sidebar.classList.contains('-translate-x-full')) {
                        sidebar.classList.remove('-translate-x-full');
                        toggleBtn.classList.add('opacity-0', 'pointer-events-none');
                  } else {
                        sidebar.classList.add('-translate-x-full');
                        toggleBtn.classList.remove('opacity-0', 'pointer-events-none');
                  }
            };

            onAuthStateChanged(auth, async (user) => {
                  if (user) {
                        document.getElementById('login-page').classList.add('hidden');
                        document.getElementById('dashboard-page').classList.remove('hidden');
                        document.getElementById('floating-toggle-btn').classList.remove('hidden');
                        await fetchStudentData(user.email);
                        initChapterNav();
                        setupRealTimeListeners(user.email);
                  } else {
                        document.getElementById('login-page').classList.remove('hidden');
                        document.getElementById('dashboard-page').classList.add('hidden');
                        document.getElementById('floating-toggle-btn').classList.add('hidden');
                  }
            });

            async function fetchStudentData(email) {
                  const q = query(collection(db, "students"), where("email", "==", email));
                  const querySnapshot = await getDocs(q);
                  if (!querySnapshot.empty) {
                        const data = querySnapshot.docs[0].data();
                        document.getElementById('userName').innerText = data.name;
                        document.getElementById('userRoll').innerText = "ID: " + data.roll;
                        document.getElementById('userInitial').innerText = data.name.charAt(0).toUpperCase();
                  }
            }

            window.studentLogin = async () => {
                  const email = document.getElementById('sEmail').value;
                  const pass = document.getElementById('sPass').value;
                  try {
                        await signInWithEmailAndPassword(auth, email, pass);
                        confetti({ particleCount: 150, spread: 70 });
                  } catch (error) { alert("Access Denied!"); }
            };

            window.logout = () => signOut(auth);
            window.togglePass = () => { const p = document.getElementById('sPass'); p.type = p.type === 'password' ? 'text' : 'password'; };
            window.toggleSubMenu = (id) => document.getElementById(id).classList.toggle('hidden');

            function initChapterNav() {
                  const nav = document.getElementById('chapter-nav');
                  nav.innerHTML = "";
                  const sections = [
                        { num: 1, title: "ICT: World & BD" },
                        { num: 2, title: "Comm. & Networking" },
                        { num: 3, title: "Binary & Logic Gates", isExpandable: true },
                        { num: 4, title: "Web Design & HTML" },
                        { num: 5, title: "Programming (C)" },
                        { num: 6, title: "Database System" },
                        { num: "B", id: "books-section", title: "Reference Books", isSpecial: true },
                        { num: "M", id: "model-qa", title: "Model Q&A", isSpecial: true }
                  ];
                  sections.forEach((sec) => {
                        if (sec.isExpandable) {
                              nav.innerHTML += `<div class="mb-3"><button onclick="toggleSubMenu('ch3-sub')" class="w-full flex items-center justify-between px-5 py-4 rounded-2xl bg-sky-500/5 text-white border border-white/5 hover:bg-sky-500/10 transition-all text-left shadow-md"><div class="flex items-center gap-3"><span class="bg-sky-500/20 px-2 py-1 rounded text-[11px] font-black">CH-03</span><span class="font-bold text-base leading-tight">${sec.title}</span></div><span class="text-xs">‚ñº</span></button><div id="ch3-sub" class="hidden pl-10 space-y-2 mt-3"><button onclick="loadChapterContent('3.1', 'Number Systems')" class="w-full p-2.5 text-sm text-left text-gray-400 hover:text-sky-400 transition-all border-l border-white/10 italic">üîπ 3.1: Number Systems</button><button onclick="loadChapterContent('3.2', 'Logic Gates')" class="w-full p-2.5 text-sm text-left text-gray-400 hover:text-sky-400 transition-all border-l border-white/10 italic">üîπ 3.2: Logic Gates</button></div></div>`;
                        } else {
                              const targetID = sec.id || sec.num;
                              const colorClass = sec.id === 'books-section' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-white/10 text-gray-400';
                              nav.innerHTML += `<button onclick="loadChapterContent('${targetID}', '${sec.title}')" class="w-full flex items-center gap-4 px-5 py-4 rounded-2xl border border-white/5 mb-3 text-gray-200 hover:bg-sky-500/10 hover:text-white transition-all text-left shadow-sm group"><span class="${colorClass} group-hover:bg-sky-500/30 px-3 py-1 rounded-xl text-[11px] font-bold transition-colors">${sec.num}</span><span class="font-bold text-base leading-tight">${sec.title}</span></button>`;
                        }
                  });
            }

            window.loadChapterContent = async (chapterNum, title) => {
                  document.getElementById('current-chapter-title').innerText = title;
                  const container = document.getElementById('resource-container');
                  container.innerHTML = `<div class="col-span-full py-16 flex flex-col items-center animate-pulse"><div class="h-10 w-10 border-4 border-sky-500 border-t-transparent rounded-full animate-spin mb-4"></div><p class="text-sky-500 text-sm tracking-[0.2em] font-black uppercase">Decrypting Resources...</p></div>`;
                  const q = query(collection(db, "resources"), where("chapter", "==", chapterNum.toString()));
                  const snapshot = await getDocs(q);
                  container.innerHTML = "";
                  if (snapshot.empty) { container.innerHTML = `<div class="col-span-full glass p-16 text-center text-gray-500 rounded-[3rem] text-base italic">No digital footprints found in this directory.</div>`; return; }
                  snapshot.forEach(docSnap => {
                        const res = docSnap.data();
                        container.innerHTML += `<div class="glass p-6 md:p-7 rounded-[2.5rem] border border-white/5 hover:border-sky-500/40 hover:bg-sky-500/5 transition-all flex items-center justify-between shadow-xl group"><div class="flex items-center gap-5"><div class="h-14 w-14 bg-sky-500/10 rounded-2xl flex items-center justify-center text-3xl group-hover:scale-110 transition-transform">${res.type === 'PDF' ? 'üìö' : 'üìΩÔ∏è'}</div><div><h4 class="text-lg font-black text-white leading-tight">${res.title}</h4><p class="text-[10px] text-gray-500 font-bold uppercase tracking-[0.2em] mt-1">${res.type} SECURED_DATA</p></div></div><a href="${res.link}" target="_blank" class="h-12 w-12 glass rounded-full flex items-center justify-center text-2xl text-sky-500 hover:bg-sky-500 hover:text-white shadow-lg transition-all">‚¨áÔ∏è</a></div>`;
                  });
            };

            function setupRealTimeListeners(email) {
                  onSnapshot(collection(db, "live_session"), (snap) => {
                        const box = document.getElementById('live-session-status');
                        if (!snap.empty) { box.innerHTML = `<div class="animate__animated animate__fadeIn"><h3 class="text-xs font-black text-emerald-500 flex items-center gap-2 mb-2 uppercase tracking-widest"><span class="h-2.5 w-2.5 bg-emerald-500 rounded-full animate-ping"></span> Live Link Active</h3><a href="${snap.docs[0].data().url}" target="_blank" class="inline-block bg-emerald-600 text-white px-7 py-3 rounded-2xl text-xs font-black hover:bg-emerald-500 transition-all shadow-xl">JOIN HUB üì°</a></div><span class="text-5xl">üöÄ</span>`; }
                        else { box.innerHTML = `<div><h3 class="text-xs font-black text-gray-500 uppercase tracking-widest">Live Session</h3><p class="text-xs text-gray-600 italic font-bold mt-1">Status: OFFLINE</p></div><span class="text-4xl opacity-20">üõ∞Ô∏è</span>`; }
                  });
                  onSnapshot(collection(db, "notices"), (snap) => { snap.forEach(doc => { const el = document.getElementById('latest-notice'); if (el) el.innerText = doc.data().text; }); });
                  onSnapshot(query(collection(db, "attendance"), where("email", "==", email)), (snap) => {
                        let perc = (snap.size / 30) * 100;
                        document.getElementById('att-percentage').innerText = Math.round(perc) + "%";
                        document.getElementById('att-bar').style.width = perc + "%";
                        document.getElementById('absent-count').innerText = (30 - snap.size);
                  });
            }

            particlesJS("particles-js", { "particles": { "number": { "value": 70 }, "color": { "value": "#0ea5e9" }, "opacity": { "value": 0.2 }, "size": { "value": 2 }, "line_linked": { "enable": true, "distance": 150, "color": "#0ea5e9", "opacity": 0.1 }, "move": { "enable": true, "speed": 1 } } });
      </script>

      <style>
            @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap');

            body {
                  background: #020617;
                  color: white;
                  font-family: 'Rajdhani', sans-serif;
                  min-height: 100vh;
                  overflow-x: hidden;
                  margin: 0;
            }

            #particles-js {
                  position: fixed;
                  width: 100%;
                  height: 100%;
                  z-index: 0;
            }

            .tech-font {
                  font-family: 'Orbitron', sans-serif;
            }

            .glass {
                  background: rgba(15, 23, 42, 0.75);
                  backdrop-filter: blur(35px);
                  border: 1px solid rgba(255, 255, 255, 0.06);
            }

            .neon-text {
                  text-shadow: 0 0 15px rgba(14, 165, 233, 0.7);
            }

            .cyber-card {
                  border: 1px solid rgba(14, 165, 233, 0.3);
                  box-shadow: 0 0 50px rgba(14, 165, 233, 0.1);
            }

            .glow-input {
                  background: rgba(2, 6, 23, 0.9);
                  border: 1px solid rgba(14, 165, 233, 0.2);
                  transition: 0.4s;
                  font-size: 1rem;
            }

            .glow-input:focus {
                  border-color: #0ea5e9;
                  box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
                  outline: none;
            }

            ::-webkit-scrollbar {
                  width: 5px;
            }

            ::-webkit-scrollbar-thumb {
                  background: #1e293b;
                  border-radius: 10px;
            }
      </style>
</head>

<body>
      <div id="particles-js"></div>

      <button id="floating-toggle-btn" onclick="toggleSidebar()"
            class="hidden fixed top-8 left-8 z-[200] bg-sky-500/20 p-5 rounded-3xl border border-sky-500/30 text-sky-400 hover:bg-sky-500 hover:text-white transition-all shadow-2xl active:scale-90">
            <span class="text-2xl">‚ò∞</span>
      </button>

      <div class="relative z-10 h-screen overflow-hidden">
            <div id="login-page"
                  class="min-h-screen flex flex-col items-center justify-center p-6 animate__animated animate__fadeIn">
                  <div class="text-center mb-10"><a href="index.html" class="group">
                              <h1
                                    class="text-5xl md:text-7xl font-black tech-font text-white uppercase neon-text tracking-tighter">
                                    ICT <span class="text-sky-500">ACADEMY</span></h1>
                        </a></div>
                  <div class="cyber-card glass p-10 md:p-14 rounded-[3rem] w-full max-w-lg relative overflow-hidden">
                        <h2
                              class="text-2xl font-black tech-font text-sky-500 uppercase text-center mb-10 tracking-[0.2em]">
                              AUTHENTICATE</h2>
                        <div class="space-y-7">
                              <input id="sEmail" type="email" placeholder="STUDENT_ID"
                                    class="w-full glow-input p-5 rounded-3xl text-white font-bold tracking-wider">
                              <div class="relative">
                                    <input id="sPass" type="password" placeholder="SECURITY_KEY"
                                          class="w-full glow-input p-5 rounded-3xl text-white tracking-[0.3em]">
                                    <button onclick="togglePass()"
                                          class="absolute right-6 top-5 text-gray-500 hover:text-sky-400 text-2xl transition-colors">üëÅÔ∏è</button>
                              </div>
                              <button onclick="studentLogin()"
                                    class="w-full bg-sky-600 hover:bg-sky-500 py-5 rounded-3xl tech-font font-black text-base transition-all shadow-xl border-b-8 border-sky-900 uppercase tracking-widest">Login
                                    _</button>
                        </div>
                  </div>
            </div>

            <div id="dashboard-page" class="hidden flex h-full">

                  <aside id="sidebar-aside"
                        class="fixed top-0 left-0 w-full lg:w-[350px] h-full glass border-r border-white/5 p-10 space-y-10 overflow-y-auto transition-all duration-500 z-[210] -translate-x-full">
                        <div class="text-center pb-8 border-b border-white/10 relative">
                              <h1
                                    class="tech-font text-sky-500 font-black text-3xl tracking-tighter uppercase leading-none">
                                    ICT HUB</h1>
                              <p class="text-[10px] text-gray-500 tracking-[0.5em] mt-4 font-black uppercase">Main
                                    Dashboard</p>
                              <button onclick="toggleSidebar()"
                                    class="absolute -top-1 -right-1 text-gray-500 hover:text-white text-3xl">√ó</button>
                        </div>
                        <div id="chapter-nav" class="space-y-1"></div>
                  </aside>

                  <div class="flex-1 flex flex-col h-full overflow-y-auto bg-[#020617]">
                        <header class="glass px-10 py-8 shadow-2xl sticky top-0 z-[100] w-full">
                              <div class="max-w-7xl mx-auto flex justify-between items-center">
                                    <div class="flex items-center gap-6 ml-14 lg:ml-0">
                                          <div class="h-14 w-14 bg-sky-500 rounded-2xl flex items-center justify-center font-black text-2xl text-white shadow-xl border-2 border-sky-400/20"
                                                id="userInitial">S</div>
                                          <div class="flex flex-col">
                                                <h2 class="text-2xl md:text-3xl font-black text-white uppercase tracking-tight leading-none"
                                                      id="userName">Student</h2>
                                                <span class="text-sky-500 font-mono text-[11px] uppercase font-bold mt-2 tracking-[0.2em] opacity-70"
                                                      id="userRoll">ID: #RA-0000</span>
                                          </div>
                                    </div>
                                    <button onclick="logout()"
                                          class="bg-red-600/10 text-red-500 border-2 border-red-500/20 px-6 py-3 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-red-600 hover:text-white transition-all active:scale-95 shadow-sm">TERMINATE</button>
                              </div>
                        </header>

                        <main class="p-8 md:p-12 space-y-10 max-w-7xl mx-auto w-full">
                              <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div
                                          class="glass p-10 rounded-[2.5rem] border-l-[10px] border-yellow-500 bg-yellow-500/5 shadow-xl group hover:bg-yellow-500/10 transition-all">
                                          <h3
                                                class="text-[10px] font-black text-yellow-500 uppercase mb-4 tracking-[0.3em]">
                                                üì¢ SYSTEM_BROADCAST</h3>
                                          <p id="latest-notice"
                                                class="text-xl font-bold italic text-gray-300 leading-relaxed">Syncing
                                                institucional protocols...</p>
                                    </div>
                                    <div id="live-session-status"
                                          class="glass p-10 rounded-[2.5rem] border border-emerald-500/20 flex items-center justify-between min-h-[140px] shadow-xl hover:border-emerald-500/50 transition-colors">
                                          <div class="space-y-2">
                                                <h3
                                                      class="text-sm font-black text-emerald-500 uppercase tracking-widest">
                                                      LIVE_LINK</h3>
                                                <p class="text-xs text-gray-500 italic font-bold">Scanning signal...</p>
                                          </div>
                                          <span class="text-6xl opacity-30 animate-pulse">üõ∞Ô∏è</span>
                                    </div>
                              </div>

                              <div class="grid grid-cols-1 xl:grid-cols-3 gap-10">
                                    <div class="xl:col-span-2 space-y-8">
                                          <h2 class="text-3xl font-black tech-font uppercase border-b-4 border-sky-500/30 pb-3 inline-block tracking-tighter"
                                                id="current-chapter-title">Library Index</h2>
                                          <div id="resource-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                          </div>
                                    </div>
                                    <div class="space-y-8">
                                          <div
                                                class="glass p-12 rounded-[4rem] text-center border-b-[10px] border-emerald-500 shadow-2xl relative overflow-hidden group">
                                                <div
                                                      class="absolute inset-0 bg-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity">
                                                </div>
                                                <h4
                                                      class="text-gray-500 text-[10px] font-black uppercase mb-6 tracking-[0.4em]">
                                                      PARTICIPATION_SCORE</h4>
                                                <div class="text-8xl font-black text-white leading-none mb-6 tracking-tighter"
                                                      id="att-percentage">0%</div>
                                                <div class="w-full bg-white/5 h-3 rounded-full overflow-hidden mb-5">
                                                      <div id="att-bar"
                                                            class="bg-emerald-500 h-full transition-all duration-1000 shadow-[0_0_15px_#10b981]"
                                                            style="width: 0%"></div>
                                                </div>
                                                <p
                                                      class="text-sm text-gray-500 uppercase font-black tracking-widest leading-none">
                                                      Absence: <span id="absent-count"
                                                            class="text-red-500 text-xl font-black">--</span> Days</p>
                                          </div>
                                    </div>
                              </div>
                        </main>
                  </div>
            </div>
      </div>
</body>

</html>